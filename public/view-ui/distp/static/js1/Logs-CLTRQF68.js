import{aM as n,az as d,q as u,r as p,z as s,bs as c,bu as y,bk as k,F as b,aK as P,a_ as L,y as O,o as x}from"./_@vue-AcWbRQZ2.js";import{_ as C}from"../js2/index-A1W57FR6.js";import"./__vendor-oHGn7YgQ.js";const N={data(){return{haveRule:!0,user_id:"",publish:{},total:0,pageSize:10,pageSizeOpts:10,page:1,current_page:1,columns:[{title:"Name",key:"user_id"},{title:"Title",key:"title"},{title:"Content",key:"content"},{title:"Date",key:"create_time",sortable:!0}],data:[]}},created(){if(JSON.parse(sessionStorage.getItem("userinfo")).isAdmin==!0)this.getLogs();else{let e=this.$router.currentRoute._value.query.menu_id;this.checkAuth(e)}},methods:{async checkAuth(t){let e=this,o=JSON.parse(sessionStorage.getItem("userinfo")).user_id;await e.$api.Admin.checkAuth({id:t,user_id:o}).then(function(a){a.data.code==200?(console.log(a.data.msg),e.haveRule=!0,e.getLogs()):(console.log(a.data.msg),e.haveRule=!1)}).catch(function(a){console.log(a)})},async getLogs(){let t=this,e=JSON.parse(sessionStorage.getItem("Publish"));e?t.publish=e:t.getPublish();let o={page:t.page,pageSize:t.pageSize,user_id:t.user_id?t.user_id:""};await t.$api.Logs.index(o).then(function(a){a.data.code==200?(t.data=a.data.data.data,t.total=a.data.data.total,t.pageSize=a.data.data.per_page,t.current_page=a.data.data.current_page):a.data.code==210?(t.page=a.data.data.page>1?a.data.data.page-1:1,t.page==1?t.data=[]:t.getLogs()):console.log(a.data.msg)}).catch(function(a){console.log(a)})},async getPublish(){let t=this;await t.$api.Admin.getPublish().then(function(e){e.data.code==200&&(sessionStorage.setItem("Publish",JSON.stringify(e.data.data)),t.publish=e.data.data)}).catch(function(e){console.log(e)})},clickSearch(){let t=this,e={page:1,pageSize:10,user_id:t.user_id?t.user_id:""};t.queryLogs(e)},async queryLogs(t){let e=this;e.$Message.loading("拼命加载中..."),await e.$api.Logs.index(t).then(function(o){o.data.code==200?setTimeout(()=>{e.data=o.data.data.data,e.total=o.data.data.total,e.pageSize=o.data.data.per_page,e.current_page=o.data.data.current_page},1e3):(console.log(o.data.msg),e.data=[],e.total=0,e.pageSize=10,e.current_page=1)}).catch(function(o){console.log(o)})},onRefresh(){this.page=1,this.pageSize=10,this.$Message.loading("拼命加载中..."),this.user_id="",setTimeout(()=>{this.getLogs()},2e3)},changePage(t){var e=this;e.page=t,e.getLogs()},nextPage(t){var e=this;e.page=t,e.getLogs()},prevPage(t){var e=this;e.page=t,e.getLogs()},pageSizeChange(t){var e=this;e.pageSize=t,e.page=1,e.getLogs()}}},w={key:0},A={class:"demo-split"},V={class:"demo-split-pane"},I={key:1};function R(t,e,o,a,i,g){const _=n("Option"),m=n("Select"),r=n("Icon"),h=n("Button"),f=n("Space"),S=n("Table"),z=n("Page"),v=n("NoAuth");return i.haveRule?(d(),u("div",w,[p("div",A,[p("div",V,[s(f,{align:"center",size:"default"},{default:c(()=>[s(m,{modelValue:i.user_id,"onUpdate:modelValue":e[0]||(e[0]=l=>i.user_id=l),placeholder:"发布人员",style:{width:"120px"},size:"default",clearable:"",filterable:""},{default:c(()=>[(d(!0),u(b,null,P(i.publish,l=>(d(),x(_,{value:l.id,key:l.id},{default:c(()=>[O(L(l.username),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),s(h,{size:"default",onClick:g.clickSearch},{default:c(()=>[s(r,{type:"ios-search",size:"18"})]),_:1},8,["onClick"]),s(h,{size:"default",onClick:g.onRefresh},{default:c(()=>[s(r,{type:"md-refresh",size:"18"})]),_:1},8,["onClick"])]),_:1})])]),s(S,{size:"small",columns:i.columns,data:i.data,border:"",style:{margin:"10px"}},null,8,["columns","data"]),y(s(z,{total:i.total,"page-size":i.pageSize,modelValue:i.current_page,"onUpdate:modelValue":e[1]||(e[1]=l=>i.current_page=l),onOnNext:g.nextPage,onOnPrev:g.prevPage,onOnChange:g.changePage,onOnPageSizeChange:g.pageSizeChange,"show-sizer":"","show-total":"","show-elevator":"",style:{margin:"10px"}},null,8,["total","page-size","modelValue","onOnNext","onOnPrev","onOnChange","onOnPageSizeChange"]),[[k,i.total>10]])])):(d(),u("div",I,[s(v)]))}const J=C(N,[["render",R]]);export{J as default};
//# sourceMappingURL=Logs-CLTRQF68.js.map
