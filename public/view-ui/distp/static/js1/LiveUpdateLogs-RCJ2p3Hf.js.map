{"version":3,"file":"LiveUpdateLogs-RCJ2p3Hf.js","sources":["../../../src/views/admin/LiveUpdateLogs.vue"],"sourcesContent":["<style>\r\n.demo-split {\r\n    height: 50px;\r\n}\r\n.demo-split-pane {\r\n    padding: 10px;\r\n}\r\n.ivu-table-sort{\r\n    width: 20px;\r\n}\r\n.ivu-page-options-sizer{\r\n    width: 100px;\r\n}\r\n</style>\r\n<template>\r\n    <div v-if=\"haveRule\">\r\n        <Table size=\"small\" :columns=\"columns\" :data=\"data\" border style=\"margin: 10px;\"></Table>\r\n        <Page :total=\"total\" :page-size=\"pageSize\" v-model=\"current_page\" @on-next=\"nextPage\" @on-prev=\"prevPage\"\r\n            @on-change=\"changePage\" @on-page-size-change=\"pageSizeChange\" show-sizer show-total show-elevator\r\n            v-show=\"total > 10\" style=\"margin: 10px;\" />\r\n    </div>\r\n    <div v-else>\r\n        <NoAuth />\r\n    </div>\r\n</template>\r\n<script>\r\nexport default {\r\n    data() {\r\n        return {\r\n            // 是否有权限\r\n            haveRule: true,\r\n\r\n            // query\r\n            publish: {},\r\n\r\n            // page\r\n            total: 0,\r\n            pageSize: 10,\r\n            pageSizeOpts: 10,\r\n            page: 1,\r\n            current_page: 1,\r\n\r\n            columns: [\r\n                {\r\n                    title: 'Title',\r\n                    key: 'title'\r\n                },\r\n                {\r\n                    title: 'Content',\r\n                    key: 'content'\r\n                },\r\n                {\r\n                    title: 'Date',\r\n                    key: 'create_time',\r\n                    sortable: true\r\n                }\r\n            ],\r\n\r\n            data: []\r\n        }\r\n    },\r\n    created() {\r\n\r\n        // 获取是否是管理员权限\r\n        let isAdmin = JSON.parse(sessionStorage.getItem('userinfo'))['isAdmin'];\r\n\r\n        if (isAdmin == true) {\r\n            this.getLiveUpdateLogs();\r\n        } else {\r\n            // 获取当前路由的参数menu_id \r\n            let menu_id = this.$router.currentRoute._value.query.menu_id;\r\n            this.checkAuth(menu_id);\r\n        }\r\n\r\n    },\r\n    methods: {\r\n        // 查询当前窗口是否有权限\r\n        async checkAuth(menu_id) {\r\n            let that = this;\r\n            let userId = JSON.parse(sessionStorage.getItem('userinfo'))['user_id']\r\n            await that.$api.Admin.checkAuth({ id: menu_id, user_id: userId }).then(function (response) {\r\n                if (response.data.code == 200) {\r\n                    console.log(response.data.msg);\r\n                    that.haveRule = true;\r\n                    that.getLiveUpdateLogs();\r\n                } else {\r\n                    console.log(response.data.msg);\r\n                    that.haveRule = false;\r\n                }\r\n            }).catch(function (error) {\r\n                console.log(error)\r\n            })\r\n        },\r\n\r\n        // 获取日志数据\r\n        async getLiveUpdateLogs() {\r\n            console.log('getLiveUpdateLogs')\r\n            let that = this;\r\n            let param = {\r\n                page: that.page,\r\n                pageSize: that.pageSize\r\n            }\r\n            await that.$api.LiveUpdateLogs.index(param).then(function (response) {\r\n\r\n                if (response.data.code == 200) {\r\n                    that.data = response.data.data.data;\r\n                    that.total = response.data.data.total;\r\n                    that.pageSize = response.data.data.per_page;\r\n                    that.current_page = response.data.data.current_page;\r\n\r\n                    // sessionStorage.setItem('AppTrace', JSON.stringify(response.data.data))\r\n                } else if (response.data.code == 210) {\r\n                    that.page = (response.data.data.page > 1) ? (response.data.data.page - 1) : 1;\r\n                    if (that.page == 1) {\r\n                        that.data = [];\r\n                    } else {\r\n                        that.getLiveUpdateLogs()\r\n                    }\r\n                } else {\r\n                    console.log(response.data.msg);\r\n                }\r\n            }).catch(function (err) {\r\n                console.log(err);\r\n            });\r\n        },\r\n\r\n\r\n        // 点击查询\r\n        clickSearch() {\r\n            let that = this;\r\n\r\n            let param = {\r\n                page: 1,\r\n                pageSize: 10\r\n            }\r\n            that.queryLiveUpdateLogs(param);\r\n        },\r\n\r\n        // 根据查询条件查询数据\r\n        async queryLiveUpdateLogs(param) {\r\n            let that = this;\r\n            that.$Message.loading('拼命加载中...');\r\n            await that.$api.LiveUpdateLogs.index(param).then(function (response) {\r\n                if (response.data.code == 200) {\r\n                    setTimeout(() => {\r\n                        that.data = response.data.data.data;\r\n                        that.total = response.data.data.total;\r\n                        that.pageSize = response.data.data.per_page;\r\n                        that.current_page = response.data.data.current_page;\r\n                    }, 1000);\r\n                } else {\r\n                    console.log(response.data.msg);\r\n                    that.data = [];\r\n                    that.total = 0;\r\n                    that.pageSize = 10;\r\n                    that.current_page = 1;\r\n                }\r\n            }).catch(function (error) {\r\n                console.log(error);\r\n            });\r\n        },\r\n\r\n        // 刷新数据\r\n        onRefresh() {\r\n            this.page = 1;\r\n            this.pageSize = 10;\r\n            this.$Message.loading('拼命加载中...');\r\n            this.user_id = '';\r\n            setTimeout(() => {\r\n                this.getLiveUpdateLogs();\r\n            }, 2000)\r\n        },\r\n        // page \r\n        // 页码改变的回调，返回改变后的页码\r\n        changePage(page) {\r\n            var that = this;\r\n            that.page = page;\r\n            that.getLiveUpdateLogs();\r\n        },\r\n        // 切换下一页时触发，返回切换后的页码\r\n        nextPage(page) {\r\n            var that = this;\r\n            that.page = page;\r\n            that.getLiveUpdateLogs();\r\n        },\r\n        // 切换上一页时触发，返回切换后的页码\r\n        prevPage(page) {\r\n            var that = this;\r\n            that.page = page;\r\n            that.getLiveUpdateLogs();\r\n        },\r\n        // 切换每页条数时的回调，返回切换后的每页条数 默认10\r\n        pageSizeChange(pageSize) {\r\n            var that = this;\r\n            that.pageSize = pageSize;\r\n            that.page = 1;\r\n            that.getLiveUpdateLogs();\r\n        },\r\n    }\r\n}\r\n</script>"],"names":["_sfc_main","menu_id","that","userId","response","error","param","err","page","pageSize","$data","_createElementBlock","_hoisted_1","_createVNode","_component_Table","_component_Page","$event","$options","_hoisted_2","_component_NoAuth"],"mappings":"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"}