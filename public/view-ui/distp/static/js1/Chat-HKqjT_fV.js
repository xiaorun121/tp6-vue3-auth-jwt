import{_ as S}from"../js2/index-A1W57FR6.js";import{aM as d,az as u,q as V,z as r,bs as n,o as c,p as m}from"./_@vue-AcWbRQZ2.js";import"./__vendor-oHGn7YgQ.js";const v={data(){return{haveRule:!0,ISAdmin:!1,rules:"",columns:[{title:"ID",key:"id",width:60,sortable:!0,align:"center"},{title:"chat_id",key:"chat_id",sortable:!0,align:"center"},{title:"detail",key:"detail",align:"center"},{title:"Action",width:110,slot:"action",align:"center"}],data:[],loading:!0,formValidateID:0,formValidate:{},modalSaveChat:!1,modelType:"add",ruleValidate:{chat_id:[{required:!0,message:"The chat_id cannot be empty",trigger:"blur"}]}}},created(){let a=JSON.parse(sessionStorage.getItem("userinfo")).isAdmin;if(this.ISAdmin=a,a==!0){let e=JSON.parse(sessionStorage.getItem("chat"));e?this.data=e:this.getChat()}else{let e=this.$router.currentRoute._value.query.menu_id;this.checkAuth(e);let t=sessionStorage.getItem("rules");t?this.rules=t:this.getUserToRules()}},methods:{isSubstring(a,e){return this.ISAdmin==!0?!0:e.split(",").map(s=>parseInt(s.trim())).includes(parseInt(a))},async getUserToRules(){let a=this,e=JSON.parse(sessionStorage.getItem("userinfo")).user_id;await a.$api.Admin.getUserToRules({user_id:e}).then(function(t){t.data.code==200&&(a.rules=t.data.data,sessionStorage.setItem("rules",t.data.data))}).catch(function(t){console.log(t)})},async checkAuth(a){let e=this,t=JSON.parse(sessionStorage.getItem("userinfo")).user_id;await e.$api.Admin.checkAuth({id:a,user_id:t}).then(function(s){s.data.code==200?(console.log(s.data.msg),e.haveRule=!0,e.getChat()):(console.log(s.data.msg),e.haveRule=!1)}).catch(function(s){console.log(s)})},async getChat(){let a=this;await a.$api.Chat.index().then(function(e){e.data.code==200?(a.data=e.data.data,sessionStorage.setItem("chat",JSON.stringify(e.data.data))):console.log(e.data.msg)}).catch(function(e){a.$Message.error("Network error, request failed")})},async saveChat(a,e){let t=this,s=JSON.parse(sessionStorage.getItem("userinfo")).user_id;t.ISAdmin==!1?await t.$api.Admin.checkIsAuthToButton({user_id:s,menu_auth_id:e}).then(function(l){l.data.code==0?t.$Message.error(l.data.msg):(t.modalSaveChat=!0,a>0?(t.modelType="read",t.getChatToId(a)):(t.formValidateID=0,t.modelType="add"))}).catch(function(l){t.$Message.error("Network error, request failed"),console.log(l)}):(t.modalSaveChat=!0,a>0?(t.modelType="read",t.getChatToId(a)):(t.formValidateID=0,t.modelType="add"))},async getChatToId(a){let e=this;await e.$api.Chat.read(a).then(function(t){t.data.code==200?(e.formValidate=t.data.data,e.formValidateID=a):e.$Message.error(t.data.msg)}).catch(function(t){e.$Message.error("Network error, request failed")})},async clickDelChat(a,e){let t=this,s=JSON.parse(sessionStorage.getItem("userinfo")).user_id;t.ISAdmin==!1?await t.$api.Admin.checkIsAuthToButton({user_id:s,menu_auth_id:e}).then(function(l){l.data.code==0?t.$Message.error(l.data.msg):t.delChat(a)}).catch(function(l){t.$Message.error("Network error, request failed"),console.log(l)}):t.delChat(a)},async delChat(a){let e=this;await e.$Modal.confirm({title:"Del",content:"Are you sure you want to delete it?",onOk:function(){e.$api.Chat.delete(a).then(function(t){e.$Message.success(t.data.msg),t.data.code==200&&e.getChat()}).catch(function(t){e.$Message.error("Network error, request failed")})}})},async saveChatData(a){let e=this,t=e.formValidateID;t>0?await e.$api.Chat.update(t,a).then(function(s){s.data.code==200?(e.$Message.success(s.data.msg),setTimeout(()=>{e.formValidateID=0,e.formValidate={},e.$refs.formValidate.resetFields(),e.getChat()},2e3)):(e.$Message.error(s.data.msg),e.$refs.formValidate.resetFields())}).catch(function(s){e.$Message.error("Network error, request failed")}):await e.$api.Chat.save(a).then(function(s){s.data.code==200?(e.$Message.success(s.data.msg),setTimeout(()=>{e.formValidate={},e.$refs.formValidate.resetFields(),e.getChat()},1e3)):(e.$Message.error(s.data.msg),e.$refs.formValidate.resetFields())}).catch(function(s){e.$Message.error("Network error, request failed")})},AsyncSaveChat(a){let e=this;e.$refs[a].validate(t=>{t?setTimeout(()=>{e.modalSaveChat=!1,e.saveChatData(e.formValidate)},1e3):(e.loading=!1,setTimeout(()=>{e.loading=!0},10))})},cancelModel(a){this.formValidate={},this.$refs[a].resetFields()}}},A={key:0},w={key:1};function M(a,e,t,s,l,i){const h=d("Icon"),g=d("Space"),f=d("Input"),_=d("FormItem"),p=d("Form"),C=d("Modal"),I=d("Table"),y=d("NoAuth");return l.haveRule?(u(),V("div",A,[r(g,{direction:"vertical",class:"demo-split"},{default:n(()=>[r(g,{wrap:"",class:"demo-split-pane"},{default:n(()=>[i.isSubstring(194,l.rules)?(u(),c(h,{key:0,type:"md-add-circle",size:"24",color:"#2db7f5",title:"add",onClick:e[0]||(e[0]=o=>i.saveChat(0,194))})):m("",!0)]),_:1})]),_:1}),l.formValidate?(u(),c(C,{key:0,modelValue:l.modalSaveChat,"onUpdate:modelValue":e[4]||(e[4]=o=>l.modalSaveChat=o),ref:"refTaskFlowModal",title:"saveChat",loading:l.loading,onOnOk:e[5]||(e[5]=o=>i.AsyncSaveChat("formValidate")),onOnCancel:e[6]||(e[6]=o=>i.cancelModel("formValidate")),"lock-scroll":"true",closable:"false",scrollable:!1},{default:n(()=>[r(p,{ref:"formValidate",model:l.formValidate,rules:l.ruleValidate,"label-width":140},{default:n(()=>[r(_,{label:"chat_id",prop:"chat_id"},{default:n(()=>[r(f,{modelValue:l.formValidate.chat_id,"onUpdate:modelValue":e[1]||(e[1]=o=>l.formValidate.chat_id=o),placeholder:"Enter something..."},null,8,["modelValue"])]),_:1}),r(_,{label:"detail"},{default:n(()=>[r(f,{modelValue:l.formValidate.detail,"onUpdate:modelValue":e[2]||(e[2]=o=>l.formValidate.detail=o),placeholder:"Enter something..."},null,8,["modelValue"])]),_:1}),r(f,{type:"hidden",modelValue:l.formValidateID,"onUpdate:modelValue":e[3]||(e[3]=o=>l.formValidateID=o)},null,8,["modelValue"])]),_:1},8,["model","rules"])]),_:1},8,["modelValue","loading"])):m("",!0),r(I,{border:"","max-height":"700",columns:l.columns,data:l.data,size:"small",style:{margin:"10px"}},{action:n(({row:o,index:T})=>[i.isSubstring(256,l.rules)?(u(),c(h,{key:0,type:"ios-create",size:"24",color:"#47cb89",title:"edit",onClick:k=>i.saveChat(o.id,256)},null,8,["onClick"])):m("",!0),i.isSubstring(195,l.rules)?(u(),c(h,{key:1,type:"ios-trash",size:"24",color:"red",title:"del",onClick:k=>i.clickDelChat(o.id,195)},null,8,["onClick"])):m("",!0)]),_:1},8,["columns","data"])])):(u(),V("div",w,[r(y)]))}const D=S(v,[["render",M]]);export{D as default};
//# sourceMappingURL=Chat-HKqjT_fV.js.map
