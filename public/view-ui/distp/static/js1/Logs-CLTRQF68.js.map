{"version":3,"file":"Logs-CLTRQF68.js","sources":["../../../src/views/admin/Logs.vue"],"sourcesContent":["<style>\r\n.demo-split {\r\n    height: 50px;\r\n}\r\n.demo-split-pane {\r\n    padding: 10px;\r\n}\r\n.ivu-table-sort{\r\n    width: 20px;\r\n}\r\n.ivu-page-options-sizer{\r\n    width: 100px;\r\n}\r\n</style>\r\n<template>\r\n    <div v-if=\"haveRule\">\r\n        <div class=\"demo-split\">\r\n            <div class=\"demo-split-pane\">\r\n                <Space align=\"center\" size=\"default\">\r\n                    <Select v-model=\"user_id\" placeholder=\"发布人员\" style=\"width:120px\" size=\"default\" clearable filterable>\r\n                        <Option v-for=\"item in publish\" :value=\"item.id\" :key=\"item.id\">{{\r\n                            item.username }}</Option>\r\n                    </Select>\r\n                    <Button size=\"default\" @click=\"clickSearch\">\r\n                        <Icon type=\"ios-search\" size=\"18\" />\r\n                    </Button>\r\n                    <Button size=\"default\" @click=\"onRefresh\">\r\n                        <Icon type=\"md-refresh\" size=\"18\" />\r\n                    </Button>\r\n                </Space>\r\n            </div>\r\n        </div>\r\n        <Table size=\"small\" :columns=\"columns\" :data=\"data\" border style=\"margin: 10px;\"></Table>\r\n        <Page :total=\"total\" :page-size=\"pageSize\" v-model=\"current_page\" @on-next=\"nextPage\" @on-prev=\"prevPage\"\r\n            @on-change=\"changePage\" @on-page-size-change=\"pageSizeChange\" show-sizer show-total show-elevator\r\n            v-show=\"total > 10\" style=\"margin: 10px;\" />\r\n    </div>\r\n    <div v-else>\r\n        <NoAuth />\r\n    </div>\r\n</template>\r\n<script>\r\nexport default {\r\n    data() {\r\n        return {\r\n            // 是否有权限\r\n            haveRule: true,\r\n\r\n            // query\r\n            user_id: '',\r\n            publish: {},\r\n\r\n            // page\r\n            total: 0,\r\n            pageSize: 10,\r\n            pageSizeOpts: 10,\r\n            page: 1,\r\n            current_page: 1,\r\n\r\n            columns: [\r\n                {\r\n                    title: 'Name',\r\n                    key: 'user_id'\r\n                },\r\n                {\r\n                    title: 'Title',\r\n                    key: 'title'\r\n                },\r\n                {\r\n                    title: 'Content',\r\n                    key: 'content'\r\n                },\r\n                {\r\n                    title: 'Date',\r\n                    key: 'create_time',\r\n                    sortable: true\r\n                }\r\n            ],\r\n\r\n            data: []\r\n        }\r\n    },\r\n    created() {\r\n\r\n        // 获取是否是管理员权限\r\n        let isAdmin = JSON.parse(sessionStorage.getItem('userinfo'))['isAdmin'];\r\n\r\n        if (isAdmin == true) {\r\n            this.getLogs();\r\n        } else {\r\n            // 获取当前路由的参数menu_id \r\n            let menu_id = this.$router.currentRoute._value.query.menu_id;\r\n            this.checkAuth(menu_id);\r\n        }\r\n\r\n    },\r\n    methods: {\r\n        // 查询当前窗口是否有权限\r\n        async checkAuth(menu_id) {\r\n            let that = this;\r\n            let userId = JSON.parse(sessionStorage.getItem('userinfo'))['user_id']\r\n            await that.$api.Admin.checkAuth({ id: menu_id, user_id: userId }).then(function (response) {\r\n                if (response.data.code == 200) {\r\n                    console.log(response.data.msg);\r\n                    that.haveRule = true;\r\n                    that.getLogs();\r\n                } else {\r\n                    console.log(response.data.msg);\r\n                    that.haveRule = false;\r\n                }\r\n            }).catch(function (error) {\r\n                console.log(error)\r\n            })\r\n        },\r\n\r\n        // 获取日志数据\r\n        async getLogs() {\r\n            let that = this;\r\n\r\n            let Publish = JSON.parse(sessionStorage.getItem('Publish'));\r\n            if(Publish){\r\n                that.publish = Publish\r\n            }else{\r\n                that.getPublish();\r\n            }\r\n\r\n            let param = {\r\n                page: that.page,\r\n                pageSize: that.pageSize,\r\n                user_id: that.user_id ? that.user_id : ''\r\n            }\r\n            await that.$api.Logs.index(param).then(function (response) {\r\n\r\n                if (response.data.code == 200) {\r\n                    that.data = response.data.data.data;\r\n                    that.total = response.data.data.total;\r\n                    that.pageSize = response.data.data.per_page;\r\n                    that.current_page = response.data.data.current_page;\r\n\r\n                    // sessionStorage.setItem('AppTrace', JSON.stringify(response.data.data))\r\n                } else if (response.data.code == 210) {\r\n                    that.page = (response.data.data.page > 1) ? (response.data.data.page - 1) : 1;\r\n                    if (that.page == 1) {\r\n                        that.data = [];\r\n                    } else {\r\n                        that.getLogs()\r\n                    }\r\n                } else {\r\n                    console.log(response.data.msg);\r\n                }\r\n            }).catch(function (err) {\r\n                console.log(err);\r\n            });\r\n        },\r\n        // 获取发布人员信息\r\n        async getPublish(){\r\n            let that = this;\r\n            await that.$api.Admin.getPublish().then( function (response) {\r\n                if (response.data.code == 200) {\r\n                    sessionStorage.setItem('Publish', JSON.stringify(response.data.data));\r\n                    that.publish = response.data.data;\r\n                }\r\n            }).catch(function (error){\r\n                console.log(error)\r\n            })\r\n        },\r\n        // 点击查询\r\n        clickSearch() {\r\n            let that = this;\r\n\r\n            let param = {\r\n                page: 1,\r\n                pageSize: 10,\r\n                user_id: that.user_id ? that.user_id : ''\r\n            }\r\n            that.queryLogs(param);\r\n        },\r\n\r\n        // 根据查询条件查询数据\r\n        async queryLogs(param) {\r\n            let that = this;\r\n            that.$Message.loading('拼命加载中...');\r\n            await that.$api.Logs.index(param).then(function (response) {\r\n                if (response.data.code == 200) {\r\n                    setTimeout(() => {\r\n                        that.data = response.data.data.data;\r\n                        that.total = response.data.data.total;\r\n                        that.pageSize = response.data.data.per_page;\r\n                        that.current_page = response.data.data.current_page;\r\n                    }, 1000);\r\n                } else {\r\n                    console.log(response.data.msg);\r\n                    that.data = [];\r\n                    that.total = 0;\r\n                    that.pageSize = 10;\r\n                    that.current_page = 1;\r\n                }\r\n            }).catch(function (error) {\r\n                console.log(error);\r\n            });\r\n        },\r\n\r\n        // 刷新数据\r\n        onRefresh() {\r\n            this.page = 1;\r\n            this.pageSize = 10;\r\n            this.$Message.loading('拼命加载中...');\r\n            this.user_id = '';\r\n            setTimeout(() => {\r\n                this.getLogs();\r\n            }, 2000)\r\n        },\r\n        // page \r\n        // 页码改变的回调，返回改变后的页码\r\n        changePage(page) {\r\n            var that = this;\r\n            that.page = page;\r\n            that.getLogs();\r\n        },\r\n        // 切换下一页时触发，返回切换后的页码\r\n        nextPage(page) {\r\n            var that = this;\r\n            that.page = page;\r\n            that.getLogs();\r\n        },\r\n        // 切换上一页时触发，返回切换后的页码\r\n        prevPage(page) {\r\n            var that = this;\r\n            that.page = page;\r\n            that.getLogs();\r\n        },\r\n        // 切换每页条数时的回调，返回切换后的每页条数 默认10\r\n        pageSizeChange(pageSize) {\r\n            var that = this;\r\n            that.pageSize = pageSize;\r\n            that.page = 1;\r\n            that.getLogs();\r\n        },\r\n    }\r\n}\r\n</script>"],"names":["_sfc_main","menu_id","that","userId","response","error","Publish","param","err","page","pageSize","_hoisted_2","_hoisted_3","$data","_createElementBlock","_hoisted_1","_createElementVNode","_createVNode","_component_Space","_component_Select","$event","_Fragment","_renderList","item","_createBlock","_component_Option","_createTextVNode","_toDisplayString","_component_Button","$options","_component_Icon","_component_Table","_component_Page","_hoisted_4","_component_NoAuth"],"mappings":"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"}