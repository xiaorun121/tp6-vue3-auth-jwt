import{aM as r,az as c,q as p,z as i,bs as d,o as u,p as m,bu as I,bk as w}from"./_@vue-AcWbRQZ2.js";import{_ as A}from"../js2/index-A1W57FR6.js";import"./__vendor-oHGn7YgQ.js";const T={data(){return{haveRule:!0,ISAdmin:!1,rules:"",columns:[{title:"ID",key:"id",width:80,sortable:!0,align:"center"},{title:"链接",key:"url",align:"center"},{title:"关键字",key:"keywords",align:"center"},{title:"创建时间",key:"create_time",align:"center"},{title:"更新时间",key:"update_time",align:"center"},{title:"Action",width:110,slot:"action",align:"center"}],data:[],total:0,pageSize:10,pageSizeOpts:10,page:1,loading:!0,formValidateID:0,formValidate:{},modalSaveBackend:!1,modelType:"add",ruleValidate:{url:[{required:!0,message:"The url cannot be empty",trigger:"blur"}],keywords:[{required:!0,message:"The keywords cannot be empty",trigger:"blur"}]},saveButton:!0}},created(){let a=JSON.parse(sessionStorage.getItem("userinfo")).isAdmin;if(this.ISAdmin=a,a==!0)this.getBackend();else{let e=this.$router.currentRoute._value.query.menu_id;this.checkAuth(e);let t=sessionStorage.getItem("rules");t?this.rules=t:this.getUserToRules()}},methods:{isSubstring(a,e){return this.ISAdmin==!0?!0:e.split(",").map(s=>parseInt(s.trim())).includes(parseInt(a))},async getUserToRules(){let a=this,e=JSON.parse(sessionStorage.getItem("userinfo")).user_id;await a.$api.Admin.getUserToRules({user_id:e}).then(function(t){t.data.code==200&&(a.rules=t.data.data,sessionStorage.setItem("rules",t.data.data))}).catch(function(t){console.log(t)})},async checkAuth(a){let e=this,t=JSON.parse(sessionStorage.getItem("userinfo")).user_id;await e.$api.Admin.checkAuth({id:a,user_id:t}).then(function(s){s.data.code==200?(console.log(s.data.msg),e.haveRule=!0,e.getBackend()):(console.log(s.data.msg),e.haveRule=!1)}).catch(function(s){console.log(s)})},async getBackend(){let a=this,e={page:a.page,pageSize:a.pageSize};await a.$api.Backend.index(e).then(function(t){t.data.code==200?(a.data=t.data.data.data,a.total=t.data.data.total,a.pageSize=t.data.data.per_page):console.log(t.data.msg)}).catch(function(t){a.$Message.error("Network error, request failed")})},async saveBackend(a,e){let t=this,s=JSON.parse(sessionStorage.getItem("userinfo")).user_id;t.ISAdmin==!1?await t.$api.Admin.checkIsAuthToButton({user_id:s,menu_auth_id:e}).then(function(l){l.data.code==0?t.$Message.error(l.data.msg):(t.modalSaveBackend=!0,a>0?(t.modelType="read",t.getBackendToId(a)):(t.formValidateID=0,t.modelType="add"))}).catch(function(l){t.$Message.error("Network error, request failed"),console.log(l)}):(t.modalSaveBackend=!0,a>0?(t.modelType="read",t.getBackendToId(a)):(t.formValidateID=0,t.modelType="add"))},async getBackendToId(a){let e=this;await e.$api.Backend.read(a).then(function(t){t.data.code==200?(e.formValidate=t.data.data,e.formValidateID=a):e.$Message.error(t.data.msg)}).catch(function(t){e.$Message.success(t)})},async clickDelBackend(a,e){let t=this,s=JSON.parse(sessionStorage.getItem("userinfo")).user_id;t.ISAdmin==!1?await t.$api.Admin.checkIsAuthToButton({user_id:s,menu_auth_id:e}).then(function(l){l.data.code==0?t.$Message.error(l.data.msg):t.delBackend(a)}).catch(function(l){t.$Message.error("Network error, request failed"),console.log(l)}):t.delBackend(a)},async delBackend(a){let e=this;await e.$Modal.confirm({title:"Del",content:"Are you sure you want to delete it?",onOk:function(){e.$api.Backend.delete(a).then(function(t){t.data.code==200&&(e.$Message.success(t.data.msg),setTimeout(()=>{e.getBackend()},1500))}).catch(function(t){e.$Message.success(t)})}})},async saveBackendData(a){let e=this,t=e.formValidateID;t>0?await e.$api.Backend.update(t,a).then(function(s){s.data.code==200?(e.$Message.success(s.data.msg),setTimeout(()=>{e.formValidateID=0,e.formValidate={},e.$refs.formValidate.resetFields(),e.getBackend()},2e3)):(e.$Message.error(s.data.msg),e.$refs.formValidate.resetFields())}).catch(function(s){e.$Message.success(s)}):await e.$api.Backend.save(a).then(function(s){s.data.code==200?(e.$Message.success(s.data.msg),setTimeout(()=>{e.formValidate={},e.$refs.formValidate.resetFields(),e.getBackend()},1e3)):(e.$Message.error(s.data.msg),e.$refs.formValidate.resetFields())}).catch(function(s){e.$Message.success(s)})},AsyncSaveBackend(a){let e=this;e.$refs[a].validate(t=>{t?setTimeout(()=>{e.modalSaveBackend=!1,e.saveBackendData(e.formValidate)},1e3):(e.loading=!1,setTimeout(()=>{e.loading=!0},10))})},cancelModel(a){this.formValidate={},this.$refs[a].resetFields()},changePage(a){var e=this;e.page=a,e.getBackend()},nextPage(a){var e=this;e.page=a,e.getBackend()},prevPage(a){var e=this;e.page=a,e.getBackend()},pageSizeChange(a){var e=this;e.pageSize=a,e.page=1,e.getBackend()}}},b={key:0},M={key:1};function z(a,e,t,s,l,n){const g=r("Icon"),h=r("Space"),f=r("Input"),k=r("FormItem"),y=r("Form"),_=r("Modal"),B=r("Table"),V=r("Page"),S=r("NoAuth");return l.haveRule?(c(),p("div",b,[i(h,{direction:"vertical",class:"demo-split"},{default:d(()=>[i(h,{wrap:"",class:"demo-split-pane"},{default:d(()=>[n.isSubstring(185,l.rules)?(c(),u(g,{key:0,type:"md-add-circle",size:"24",color:"#2db7f5",title:"add",onClick:e[0]||(e[0]=o=>n.saveBackend(0,185))})):m("",!0)]),_:1})]),_:1}),l.formValidate?(c(),u(_,{key:0,modelValue:l.modalSaveBackend,"onUpdate:modelValue":e[4]||(e[4]=o=>l.modalSaveBackend=o),ref:"refTaskFlowModal",title:"saveBackend",loading:l.loading,onOnOk:e[5]||(e[5]=o=>n.AsyncSaveBackend("formValidate")),onOnCancel:e[6]||(e[6]=o=>n.cancelModel("formValidate")),"lock-scroll":"true",closable:"false",scrollable:!1},{default:d(()=>[i(y,{ref:"formValidate",model:l.formValidate,rules:l.ruleValidate,"label-width":90},{default:d(()=>[i(k,{label:"url",prop:"url"},{default:d(()=>[i(f,{modelValue:l.formValidate.url,"onUpdate:modelValue":e[1]||(e[1]=o=>l.formValidate.url=o),placeholder:"Enter something..."},null,8,["modelValue"])]),_:1}),i(k,{label:"keywords",prop:"keywords"},{default:d(()=>[i(f,{modelValue:l.formValidate.keywords,"onUpdate:modelValue":e[2]||(e[2]=o=>l.formValidate.keywords=o),placeholder:"Enter something..."},null,8,["modelValue"])]),_:1}),i(f,{type:"hidden",modelValue:l.formValidateID,"onUpdate:modelValue":e[3]||(e[3]=o=>l.formValidateID=o)},null,8,["modelValue"])]),_:1},8,["model","rules"])]),_:1},8,["modelValue","loading"])):m("",!0),i(B,{border:"","max-height":"700",columns:l.columns,data:l.data,size:"small",style:{margin:"10px"}},{action:d(({row:o,index:O})=>[n.isSubstring(186,l.rules)?(c(),u(g,{key:0,type:"ios-create",size:"24",color:"#47cb89",title:"edit",onClick:v=>n.saveBackend(o.id,186)},null,8,["onClick"])):m("",!0),n.isSubstring(187,l.rules)?(c(),u(g,{key:1,type:"ios-trash",size:"24",color:"red",title:"del",onClick:v=>n.clickDelBackend(o.id,187)},null,8,["onClick"])):m("",!0)]),_:1},8,["columns","data"]),I(i(V,{total:l.total,"page-size":l.pageSize,onOnNext:n.nextPage,onOnPrev:n.prevPage,onOnChange:n.changePage,onOnPageSizeChange:n.pageSizeChange,"show-sizer":"","show-total":"","show-elevator":"",style:{margin:"10px"}},null,8,["total","page-size","onOnNext","onOnPrev","onOnChange","onOnPageSizeChange"]),[[w,l.total>10]])])):(c(),p("div",M,[i(S)]))}const x=A(T,[["render",z]]);export{x as default};
//# sourceMappingURL=Backend-QfrPoM7M.js.map
