import{_ as B}from"../js2/index-A1W57FR6.js";import{aM as u,az as d,q as S,z as i,bs as r,o as m,p as h,al as V,y,F as C,aK as D,r as M,a_ as k}from"./_@vue-AcWbRQZ2.js";import"./__vendor-oHGn7YgQ.js";const x={data(){return{haveRule:!0,ISAdmin:!1,rules:"",loading:!0,modalAddMenu:!1,formValidate:{title:"",parent_id:"",module_name:"",controller_name:"",view_name:"",is_menu:!1,sorts:""},formValidateID:0,ruleValidate:{name:[{required:!0,message:"The MenuName cannot be empty",trigger:"blur"}],parent_id:[{required:!0,message:"The ParentMenu cannot be empty",trigger:"blur",type:"number"}]},ParentMenu:[],editButtonStatus:"none",delButtonStatus:"none",marginLeftDel:"0 0 0 14px",columns:[{type:"selection",width:60,align:"center"},{title:"Title",width:250,slot:"title"},{title:"IsMenu",key:"is_menu",slot:"is_menu"},{title:"ModuleName",key:"module_name"},{title:"ControllerName",key:"controller_name"},{title:"ViewName",key:"view_name"},{title:"CreateTime",key:"create_time"},{title:"UpdateTime",key:"update_time"},{title:"Sort",key:"sorts"},{title:"Action",slot:"action",width:110,align:"center"}],data:[],selectId:0,selectIds:[],defaultSelected:[]}},created(){let s=JSON.parse(sessionStorage.getItem("userinfo")).isAdmin;if(this.ISAdmin=s,s==!0){let e=sessionStorage.getItem("getData");e?JSON.parse(e).name!="menu"&&this.getMenu():this.getMenu()}else{let e=this.$router.currentRoute._value.query.menu_id;this.checkAuth(e);let l=sessionStorage.getItem("rules");l?this.rules=l:this.getUserToRules()}},methods:{isSubstring(s,e){return this.ISAdmin==!0?!0:e.split(",").map(n=>parseInt(n.trim())).includes(parseInt(s))},async getUserToRules(){let s=this,e=JSON.parse(sessionStorage.getItem("userinfo")).user_id;await s.$api.Admin.getUserToRules({user_id:e}).then(function(l){l.data.code==200&&(s.rules=l.data.data,sessionStorage.setItem("rules",l.data.data))}).catch(function(l){console.log(l)})},async checkAuth(s){let e=this,l=JSON.parse(sessionStorage.getItem("userinfo")).user_id;await e.$api.Admin.checkAuth({id:s,user_id:l}).then(function(n){n.data.code==200?(e.haveRule=!0,e.getMenu()):e.haveRule=!1}).catch(function(n){console.log(n)})},async getMenu(s=0){var e=this;let l=JSON.parse(sessionStorage.getItem("menu"));if(l)e.data=l;else if(sessionStorage.setItem("getData",JSON.stringify({name:"menu"})),s==1){let n={is_menu:s,user_id:JSON.parse(sessionStorage.getItem("userinfo")).user_id};await e.$api.Menu.index(n).then(function(t){t.data.code==200?e.$store.commit("menuListLeft",t.data.data.data_left):e.$store.commit("menuListLeft","")}).catch(function(t){e.$Message.error("Network error, request failed"),console.log(t)})}else{let n={is_menu:s};await e.$api.Menu.index(n).then(function(t){t.data.code==200&&(sessionStorage.setItem("menu",JSON.stringify(t.data.data.data)),e.data=JSON.parse(sessionStorage.getItem("menu")))}).catch(function(t){e.$Message.error("Network error, request failed"),console.log(t)})}},selectOne(s,e){if(s.length===1)this.editButtonStatus="inline-block",this.delButtonStatus="inline-block",this.selectId=e.id,this.selectIds=[s[0].id];else{this.editButtonStatus="none",this.delButtonStatus="inline-block",this.marginLeftDel="0 0 0 18px",this.selectId=0,this.selectIds=[];for(var l=0;l<s.length;l++)this.selectIds.push(s[l].id)}e.children&&e.children.forEach((n,t)=>{n._checked=!0})},cancelSelectOne(s,e){if(s.length===0)this.editButtonStatus="none",this.delButtonStatus="none",this.selectId=0,this.selectIds=[];else if(s.length===1)this.editButtonStatus="inline-block",this.marginLeftDel="0 0 0 14px",this.selectId=s[0].id,this.selectIds=[s[0].id];else{this.editButtonStatus="none",this.marginLeftDel="0 0 0 18px",this.selectId=0,this.selectIds=[];for(var l=0;l<s.length;l++)this.selectIds.push(s[l].id)}},selectAll(s){this.editButtonStatus="none",this.delButtonStatus="inline-block",this.marginLeftDel="0 0 0 18px",this.selectId=0;for(var e=0;e<s.length;e++)this.selectIds.push(s[e].id)},cancelSelectAll(){this.editButtonStatus="none",this.delButtonStatus="none",this.selectId=0,this.selectIds=[]},clickChangeSwitch(s,e,l){return new Promise(n=>{let t=this,o=JSON.parse(sessionStorage.getItem("userinfo")).user_id;t.ISAdmin==!1?t.$api.Admin.checkIsAuthToButton({user_id:o,menu_auth_id:l}).then(function(c){if(c.data.code==0)return t.$Message.error(c.data.msg),!1;t.changeSwitch(s,e),n()}).catch(function(c){t.$Message.error("Network error, request failed"),console.log(c)}):(t.changeSwitch(s,e),n())})},async changeSwitch(s,e){let l=e!==!0,n=this;await this.$api.Menu.update(s,{is_menu:l}).then(function(t){t.data.code==200?(sessionStorage.removeItem("menu"),n.getMenu(),n.getMenu(1),n.$Message.success("IsMenu: "+(e===!0?"close":"open"))):n.$Message.success("IsMenu Enable exception")}).catch(function(t){n.$Message.error("Network error, request failed"),console.log(t)})},addMenu(s){let e=this,l=JSON.parse(sessionStorage.getItem("isTree")),n=JSON.parse(sessionStorage.getItem("userinfo")).user_id;e.ISAdmin==!1?e.$api.Admin.checkIsAuthToButton({user_id:n,menu_auth_id:s}).then(function(t){t.data.code==0?e.$Message.error(t.data.msg):(e.modalAddMenu=!0,l?e.ParentMenu=l:e.getTree())}).catch(function(t){console.log(t)}):(e.modalAddMenu=!0,l?e.ParentMenu=l:e.getTree())},async getTree(){var s=this;await s.$api.Menu.getTree().then(function(e){e.data.code==200?(sessionStorage.setItem("isTree",JSON.stringify(e.data.data)),s.ParentMenu=JSON.parse(sessionStorage.getItem("isTree"))):console.log(e.data.msg)}).catch(function(e){console.log(e)})},async editMenu(s,e){var l=this;let n=JSON.parse(sessionStorage.getItem("userinfo")).user_id;l.ISAdmin==!1?await l.$api.Admin.checkIsAuthToButton({user_id:n,menu_auth_id:e}).then(function(t){t.data.code==0?l.$Message.error(t.data.msg):l.readMenu(s)}).catch(function(t){l.$Message.error(response.data.msg)}):l.readMenu(s)},async readMenu(s){var e=this;e.modalAddMenu=!0,e.formValidate={};let l=JSON.parse(sessionStorage.getItem("isTree"));l?e.ParentMenu=l:e.getTree(),await e.$api.Menu.read(s).then(function(n){n.data.code==200?(e.formValidate=n.data.data,e.formValidateID=s):e.$Message.error(n.data.msg)}).catch(function(n){e.$Message.error("Network error, request failed"),console.log(n)})},async delMenu(s,e,l){var n=this;let t=JSON.parse(sessionStorage.getItem("userinfo")).user_id;n.ISAdmin==!1?await n.$api.Admin.checkIsAuthToButton({user_id:t,menu_auth_id:l}).then(function(o){o.data.code==0?n.$Message.error(o.data.msg):n.delsMenu(s,e)}).catch(function(o){n.$Message.error(response.data.msg)}):n.delsMenu(s,e)},delsMenu(s,e){var l=this.selectIds,n=this;n.$Modal.confirm({title:"Del",content:"Are you sure you want to delete it?",onOk:function(){e==="top"?n.$api.Menu.deleteMenuForIds({ids:l}).then(function(t){t.data.code==200?(n.$Message.success(t.data.msg),n.editButtonStatus="none",n.delButtonStatus="none",sessionStorage.removeItem("menu"),n.getMenu(),n.getMenu(1),n.getTree()):n.$Message.error(t.data.msg)}).catch(function(t){n.$Message.error("Network error, request failed"),console.log(t)}):n.$api.Menu.delete(s).then(function(t){t.data.code==200?(n.$Message.success(t.data.msg),n.editButtonStatus="none",n.delButtonStatus="none",sessionStorage.removeItem("menu"),n.getMenu(),n.getMenu(1),n.getTree()):n.$Message.error(t.data.msg)}).catch(function(t){n.$Message.error("Network error, request failed"),console.log(t)})}})},AsyncSaveMenu(s){var e=this;this.$refs[s].validate(l=>{l?setTimeout(()=>{e.formValidateID===0?this.$api.Menu.save(this.formValidate).then(function(n){n.data.code==200&&(e.$Message.success("Nenu Save Success!"),e.modalAddMenu=!1,e.formValidate={},e.editButtonStatus="none",e.delButtonStatus="none",sessionStorage.removeItem("menu"),e.getMenu(),e.getMenu(1),e.getTree())}).catch(function(n){e.$Message.error("Network error, request failed"),console.log(n)}):this.$api.Menu.update(e.formValidateID,this.formValidate).then(function(n){n.data.code==200&&(e.$Message.success("Nenu Save Success!"),e.modalAddMenu=!1,e.formValidate={},e.formValidateID=0,e.editButtonStatus="none",e.delButtonStatus="none",sessionStorage.removeItem("menu"),e.getMenu(),e.getMenu(1),e.getTree())}).catch(function(n){e.$Message.error("Network error, request failed"),console.log(n)})},1e3):(this.$Message.error("Fail!"),this.loading=!1,setTimeout(()=>{this.loading=!0},10))})},cancelModel(){this.modalAddMenu=!1,this.formValidate={}}}},J={key:0},q=M("span",null,"On",-1),U=M("span",null,"Off",-1),z={key:1};function L(s,e,l,n,t,o){const c=u("Icon"),p=u("Space"),g=u("Input"),f=u("FormItem"),_=u("Option"),A=u("Select"),I=u("Switch"),v=u("Form"),N=u("Modal"),O=u("Table"),b=u("NoAuth");return t.haveRule?(d(),S("div",J,[i(p,{direction:"vertical",class:"demo-split"},{default:r(()=>[i(p,{wrap:"",class:"demo-split-pane"},{default:r(()=>[o.isSubstring(41,t.rules)?(d(),m(c,{key:0,type:"md-add-circle",size:"24",color:"#2db7f5",title:"add",onClick:e[0]||(e[0]=a=>o.addMenu(41))})):h("",!0),o.isSubstring(42,t.rules)?(d(),m(c,{key:1,type:"ios-create",size:"24",color:"#47cb89",title:"edit",style:V({margin:"0 0 0 14px",display:t.editButtonStatus}),onClick:e[1]||(e[1]=a=>o.editMenu(t.selectId,42))},null,8,["style"])):h("",!0),o.isSubstring(43,t.rules)?(d(),m(c,{key:2,type:"ios-trash",size:"24",color:"red",title:"del",style:V({margin:t.marginLeftDel,display:t.delButtonStatus}),onClick:e[2]||(e[2]=a=>o.delMenu(t.selectIds,"top",43))},null,8,["style"])):h("",!0)]),_:1})]),_:1}),t.formValidate?(d(),m(N,{key:0,modelValue:t.modalAddMenu,"onUpdate:modelValue":e[11]||(e[11]=a=>t.modalAddMenu=a),title:"addMenu",loading:t.loading,onOnOk:e[12]||(e[12]=a=>o.AsyncSaveMenu("formValidate")),onOnCancel:o.cancelModel,draggable:"true",sticky:"true","reset-drag-position":""},{default:r(()=>[i(v,{ref:"formValidate",model:t.formValidate,rules:t.ruleValidate,"label-width":100},{default:r(()=>[i(f,{label:"MenuTitle",prop:"title"},{default:r(()=>[i(g,{modelValue:t.formValidate.title,"onUpdate:modelValue":e[3]||(e[3]=a=>t.formValidate.title=a),placeholder:"Enter something..."},null,8,["modelValue"])]),_:1}),i(f,{label:"ParentMenu",prop:"parent_id"},{default:r(()=>[i(A,{modelValue:t.formValidate.parent_id,"onUpdate:modelValue":e[4]||(e[4]=a=>t.formValidate.parent_id=a),filterable:"true"},{default:r(()=>[(d(),m(_,{value:0,key:0},{default:r(()=>[y("父级菜单")]),_:1})),(d(!0),S(C,null,D(t.ParentMenu,a=>(d(),m(_,{value:a.id,key:a.id},{default:r(()=>[y(k(a.title),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),i(f,{label:"Module"},{default:r(()=>[i(g,{modelValue:t.formValidate.module_name,"onUpdate:modelValue":e[5]||(e[5]=a=>t.formValidate.module_name=a),placeholder:"Enter something..."},null,8,["modelValue"])]),_:1}),i(f,{label:"Controller"},{default:r(()=>[i(g,{modelValue:t.formValidate.controller_name,"onUpdate:modelValue":e[6]||(e[6]=a=>t.formValidate.controller_name=a),placeholder:"Enter something..."},null,8,["modelValue"])]),_:1}),i(f,{label:"View"},{default:r(()=>[i(g,{modelValue:t.formValidate.view_name,"onUpdate:modelValue":e[7]||(e[7]=a=>t.formValidate.view_name=a),placeholder:"Enter something..."},null,8,["modelValue"])]),_:1}),i(f,{label:"IsMenu"},{default:r(()=>[i(I,{modelValue:t.formValidate.is_menu,"onUpdate:modelValue":e[8]||(e[8]=a=>t.formValidate.is_menu=a),size:"large"},{open:r(()=>[q]),close:r(()=>[U]),_:1},8,["modelValue"])]),_:1}),i(f,{label:"Sort"},{default:r(()=>[i(g,{modelValue:t.formValidate.sorts,"onUpdate:modelValue":e[9]||(e[9]=a=>t.formValidate.sorts=a),placeholder:"Enter something..."},null,8,["modelValue"])]),_:1}),i(g,{type:"hidden",modelValue:t.formValidateID,"onUpdate:modelValue":e[10]||(e[10]=a=>t.formValidateID=a)},null,8,["modelValue"])]),_:1},8,["model","rules"])]),_:1},8,["modelValue","loading","onOnCancel"])):h("",!0),i(O,{border:"",stripe:"","max-height":"700",ref:"selection",columns:t.columns,data:t.data,size:"small",onOnSelect:o.selectOne,onOnSelectCancel:o.cancelSelectOne,onOnSelectAll:o.selectAll,onOnSelectAllCancel:o.cancelSelectAll,style:{margin:"10px"}},{title:r(({row:a})=>[M("strong",null,k(a.title),1)]),is_menu:r(({row:a})=>[i(I,{"model-value":a.is_menu,size:"small","before-change":w=>o.clickChangeSwitch(a.id,a.is_menu,252)},null,8,["model-value","before-change"])]),action:r(({row:a,index:w})=>[o.isSubstring(42,t.rules)?(d(),m(c,{key:0,type:"ios-create",size:"24",color:"#47cb89",title:"edit",onClick:T=>o.editMenu(a.id,42)},null,8,["onClick"])):h("",!0),o.isSubstring(43,t.rules)?(d(),m(c,{key:1,type:"ios-trash",size:"24",color:"red",title:"del",onClick:T=>o.delMenu(a.id,"right",43)},null,8,["onClick"])):h("",!0)]),_:1},8,["columns","data","onOnSelect","onOnSelectCancel","onOnSelectAll","onOnSelectAllCancel"])])):(d(),S("div",z,[i(b)]))}const R=B(x,[["render",L]]);export{R as default};
//# sourceMappingURL=Menu-8GVOJ74t.js.map
