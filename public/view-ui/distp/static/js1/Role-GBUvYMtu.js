import{_ as N}from"../js2/index-A1W57FR6.js";import{aM as d,az as c,q as k,z as u,bs as n,o as h,aj as b,p as m,r as g,a_ as v}from"./_@vue-AcWbRQZ2.js";import"./__vendor-oHGn7YgQ.js";const O={data(){return{haveRule:!0,ISAdmin:!1,rules:"",loading:!0,modalAddAuthGroup:!1,formValidateID:0,formValidate:{title:"",status:!1},ruleValidate:{title:[{required:!0,message:"The title cannot be empty",trigger:"blur"}]},menuList:[],columns:[{title:"ID",width:60,key:"id"},{title:"Title",width:250,slot:"title"},{title:"Status",slot:"status",width:76},{title:"Rules",key:"rules"},{title:"CreateTime",key:"create_time",width:150},{title:"UpdateTime",key:"update_time",width:150},{title:"Action",slot:"action",width:110,align:"center"}],data:[]}},created(){let r=JSON.parse(sessionStorage.getItem("userinfo")).isAdmin;if(this.ISAdmin=r,r==!0){let e=sessionStorage.getItem("authGroup");e?this.data=JSON.parse(e):this.getAuthGroup()}else{let e=this.$router.currentRoute._value.query.menu_id;this.checkAuth(e);let t=sessionStorage.getItem("rules");t?this.rules=t:this.getUserToRules()}},methods:{isSubstring(r,e){return this.ISAdmin==!0?!0:e.split(",").map(a=>parseInt(a.trim())).includes(parseInt(r))},async getUserToRules(){let r=this,e=JSON.parse(sessionStorage.getItem("userinfo")).user_id;await r.$api.Admin.getUserToRules({user_id:e}).then(function(t){t.data.code==200&&(r.rules=t.data.data,sessionStorage.setItem("rules",t.data.data))}).catch(function(t){console.log(t)})},async checkAuth(r){let e=this,t=JSON.parse(sessionStorage.getItem("userinfo")).user_id;await e.$api.Admin.checkAuth({id:r,user_id:t}).then(function(a){a.data.code==200?(e.haveRule=!0,e.getAuthGroup()):e.haveRule=!1}).catch(function(a){console.log(a)})},clickTree(r,e){if(e.checked===!0){if(e.children)for(let t=0;t<e.children.length;t++)if(e.children[t].children)for(let a=0;a<e.children[t].children.length;a++)e.children[t].children[a].checked=!0,e.children[t].checked=!0;else e.children[t].checked=!0}else if(e.children)for(let t=0;t<e.children.length;t++)if(e.children[t].children)for(let a=0;a<e.children[t].children.length;a++)e.children[t].children[a].checked=!1,e.children[t].checked=!1;else e.children[t].checked=!1},async getAuthGroup(){let r=this;await r.$api.AuthGroup.index().then(function(e){e.data.code==200?(sessionStorage.setItem("authGroup",JSON.stringify(e.data.data.data)),sessionStorage.setItem("menuList",JSON.stringify(e.data.data.menu)),r.data=JSON.parse(sessionStorage.getItem("authGroup")),r.menuList=JSON.parse(sessionStorage.getItem("menuList"))):r.data=[]}).catch(function(e){r.$Message.error("Network error, request failed"),console.log(e)})},clickChangeSwitch(r,e,t){return new Promise(a=>{let s=this,i=JSON.parse(sessionStorage.getItem("userinfo")).user_id;s.ISAdmin==!1?s.$api.Admin.checkIsAuthToButton({user_id:i,menu_auth_id:t}).then(function(l){if(l.data.code==0)return s.$Message.error(l.data.msg),!1;s.changeSwitch(r,e),a()}).catch(function(l){s.$Message.error("Network error, request failed"),console.log(l)}):(s.changeSwitch(r,e),a())})},async changeSwitch(r,e){let t=e!==!0,a=this;await a.$api.AuthGroup.update(r,{status:t}).then(function(s){s.data.code==200?(sessionStorage.removeItem("authGroup"),a.getAuthGroup(),a.$Message.success("status: "+(e===!0?"close":"open"))):a.$Message.success("status Enable exception")}).catch(function(s){a.$Message.error("Network error, request failed"),console.log(s)})},async addAuthGroup(r){let e=this,t=JSON.parse(sessionStorage.getItem("userinfo")).user_id;if(e.ISAdmin==!1)await e.$api.Admin.checkIsAuthToButton({user_id:t,menu_auth_id:r}).then(function(a){if(a.data.code==0)e.$Message.error(a.data.msg);else{e.modalAddAuthGroup=!0,e.formValidateID=0;let s=sessionStorage.getItem("menuList");s&&(e.menuList=JSON.parse(s))}}).catch(function(a){e.$Message.error("Network error, request failed"),console.log(a)});else{e.modalAddAuthGroup=!0,e.formValidateID=0;let a=sessionStorage.getItem("menuList");a&&(e.menuList=JSON.parse(a))}},async editAuthGroup(r,e){var t=this;let a=JSON.parse(sessionStorage.getItem("userinfo")).user_id;t.ISAdmin==!1?await t.$api.Admin.checkIsAuthToButton({user_id:a,menu_auth_id:e}).then(function(s){s.data.code==0?t.$Message.error(s.data.msg):t.readAuthGroup(r)}).catch(function(s){t.$Message.error("Network error, request failed"),console.log(s)}):t.readAuthGroup(r)},async readAuthGroup(r){let e=this;e.$Message.loading("拼命加载中..."),setTimeout(()=>{e.modalAddAuthGroup=!0},1e3),e.menuList=[],await e.$api.AuthGroup.read(r).then(function(t){t.data.code==200?(e.formValidate=t.data.data.data,e.menuList=t.data.data.menu,e.formValidateID=r):e.$Message.success(t.data.msg)}).catch(function(t){e.$Message.error("Network error, request failed"),console.log(t)})},async clickDelAuthGroup(r,e){var t=this;let a=JSON.parse(sessionStorage.getItem("userinfo")).user_id;t.ISAdmin==!1?await t.$api.Admin.checkIsAuthToButton({user_id:a,menu_auth_id:e}).then(function(s){s.data.code==0?t.$Message.error(s.data.msg):t.delAuthGroup(r)}).catch(function(s){t.$Message.error("Network error, request failed"),console.log(s)}):t.delAuthGroup(r)},delAuthGroup(r){let e=this;this.$Modal.confirm({title:"Del",content:"Are you sure you want to delete it?",onOk:function(){e.$api.AuthGroup.delete(r).then(function(t){t.data.code==200?(e.$Message.success(t.data.msg),e.getAuthGroup()):e.$Message.error(t.data.msg)}).catch(function(t){e.$Message.error("Network error, request failed"),console.log(t)})}})},async AsyncSaveAuthGroup(r){let e=this;await this.$refs[r].validate(t=>{t?(setTimeout(()=>{let a=this.$refs.tree.getCheckedAndIndeterminateNodes(),s=[];for(let l=0;l<a.length;l++)s.push(a[l].id);if(a==""){this.loading=!1,setTimeout(()=>{e.$Message.error("Rules Must be Check!"),this.loading=!0},100);return}s.join(",");let i={title:e.formValidate.title,status:e.formValidate.status,rules:s};e.formValidateID===0?e.$api.AuthGroup.save(i).then(function(l){l.data.code==200?(e.$Message.success(l.data.msg),e.modalAddAuthGroup=!1,e.formValidate={title:"",status:!1},e.getAuthGroup()):e.$Message.success(l.data.msg)}).catch(function(l){e.$Message.error("Network error, request failed"),console.log(l)}):e.$api.AuthGroup.update(e.formValidateID,i).then(function(l){l.data.code==200?(e.$Message.success(l.data.msg),e.modalAddAuthGroup=!1,e.formValidate={title:"",status:!1},e.getAuthGroup()):e.$Message.success(l.data.msg)}).catch(function(l){e.$Message.error("Network error, request failed"),console.log(l)})},1e3),sessionStorage.removeItem("rules")):(this.loading=!1,setTimeout(()=>{this.loading=!0},10))})},cancelModel(){this.formValidate={title:"",status:!1},this.menuList=[],this.$refs.formValidate.resetFields()}}},T={key:0},$=g("span",null,"On",-1),C=g("span",null,"Off",-1),J={key:1};function L(r,e,t,a,s,i){const l=d("Icon"),p=d("Space"),A=d("Input"),f=d("FormItem"),_=d("Switch"),S=d("Tree"),I=d("Form"),G=d("Modal"),V=d("Table"),y=d("NoAuth");return s.haveRule?(c(),k("div",T,[u(p,{direction:"vertical",class:"demo-split"},{default:n(()=>[u(p,{wrap:"",class:"demo-split-pane"},{default:n(()=>[i.isSubstring(44,s.rules)?(c(),h(l,{key:0,type:"md-add-circle",size:"24",color:"#2db7f5",title:"add",onClick:e[0]||(e[0]=o=>i.addAuthGroup(44))})):m("",!0)]),_:1})]),_:1}),s.formValidate?(c(),h(G,{key:0,modelValue:s.modalAddAuthGroup,"onUpdate:modelValue":e[4]||(e[4]=o=>s.modalAddAuthGroup=o),ref:"refTaskFlowModal",title:"addAuthGroup",loading:s.loading,onOnOk:e[5]||(e[5]=o=>i.AsyncSaveAuthGroup("formValidate")),onOnCancel:i.cancelModel,"lock-scroll":"true",closable:"true",scrollable:!1,class:b("custom-modal")},{default:n(()=>[u(I,{ref:"formValidate",model:s.formValidate,rules:s.ruleValidate,"label-width":100},{default:n(()=>[u(f,{label:"Title",prop:"title"},{default:n(()=>[u(A,{modelValue:s.formValidate.title,"onUpdate:modelValue":e[1]||(e[1]=o=>s.formValidate.title=o),placeholder:"Enter something..."},null,8,["modelValue"])]),_:1}),u(f,{label:"Status"},{default:n(()=>[u(_,{modelValue:s.formValidate.status,"onUpdate:modelValue":e[2]||(e[2]=o=>s.formValidate.status=o),size:"large"},{open:n(()=>[$]),close:n(()=>[C]),_:1},8,["modelValue"])]),_:1}),u(f,{label:"Rules"},{default:n(()=>[u(S,{data:s.menuList,ref:"tree",multiple:"","show-checkbox":"",onOnCheckChange:i.clickTree,"check-strictly":!0,"check-directly":!0},null,8,["data","onOnCheckChange"])]),_:1}),u(A,{type:"hidden",modelValue:s.formValidateID,"onUpdate:modelValue":e[3]||(e[3]=o=>s.formValidateID=o)},null,8,["modelValue"])]),_:1},8,["model","rules"])]),_:1},8,["modelValue","loading","onOnCancel"])):m("",!0),u(V,{border:"",stripe:"","max-height":"700",ref:"selection",columns:s.columns,data:s.data,size:"small",style:{margin:"10px"}},{title:n(({row:o})=>[g("strong",null,v(o.title),1)]),status:n(({row:o})=>[u(_,{"model-value":o.status,size:"small","before-change":w=>i.clickChangeSwitch(o.id,o.status,50)},null,8,["model-value","before-change"])]),action:n(({row:o,index:w})=>[i.isSubstring(45,s.rules)?(c(),h(l,{key:0,type:"ios-create",size:"24",color:"#47cb89",title:"edit",onClick:M=>i.editAuthGroup(o.id,45)},null,8,["onClick"])):m("",!0),i.isSubstring(46,s.rules)?(c(),h(l,{key:1,type:"ios-trash",size:"24",color:"red",title:"del",onClick:M=>i.clickDelAuthGroup(o.id,46)},null,8,["onClick"])):m("",!0)]),_:1},8,["columns","data"])])):(c(),k("div",J,[u(y)]))}const z=N(O,[["render",L]]);export{z as default};
//# sourceMappingURL=Role-GBUvYMtu.js.map
