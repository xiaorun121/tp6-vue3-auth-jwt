{"version":3,"file":"Admin-0LDa1mgf.js","sources":["../../../src/views/admin/Admin.vue"],"sourcesContent":["<template>\r\n    <div v-if=\"haveRule\">\r\n        <Form ref=\"formCustom\" :model=\"formCustom\" :rules=\"ruleCustom\" :label-width=\"150\" :style=\"{ width: '99%' }\">\r\n            <FormItem label=\"Website Name\" prop=\"name\">\r\n                <Input v-model=\"formCustom.name\" type=\"text\" placeholder=\"Enter your Website Name\"></Input>\r\n            </FormItem>\r\n            <FormItem label=\"Website Domain\" prop=\"url\">\r\n                <Input v-model=\"formCustom.url\" type=\"text\" placeholder=\"Website Domain\"></Input>\r\n            </FormItem>\r\n            <FormItem label=\"Website Title\" prop=\"title\">\r\n                <Input v-model=\"formCustom.title\" type=\"textarea\" placeholder=\"Enter Website Title...\"></Input>\r\n            </FormItem>\r\n            <FormItem label=\"Website Keyword\" prop=\"keywords\">\r\n                <Input v-model=\"formCustom.keywords\" type=\"textarea\" placeholder=\"Enter Website Keyword...\"></Input>\r\n            </FormItem>\r\n            <FormItem label=\"Website Description\" prop=\"description\">\r\n                <Input v-model=\"formCustom.description\" type=\"textarea\"\r\n                    placeholder=\"Enter Website Description...\"></Input>\r\n            </FormItem>\r\n            <FormItem label=\"Website Copyright\" prop=\"copyright\">\r\n                <Input v-model=\"formCustom.copyright\" type=\"textarea\" placeholder=\"Enter Website Copyright...\"></Input>\r\n            </FormItem>\r\n            <FormItem>\r\n                <Button type=\"primary\" size=\"default\" @click=\"handleSubmit('formCustom', 247)\"\r\n                    v-if=\"isSubstring(247, rules)\">Submit</Button>\r\n                <Button @click=\"handleReset('formCustom')\" size=\"default\" style=\"margin-left: 8px\">Reset</Button>\r\n            </FormItem>\r\n        </Form>\r\n    </div>\r\n    <div v-else>\r\n        <NoAuth />\r\n    </div>\r\n</template>\r\n<script>\r\nexport default {\r\n    data() {\r\n        let validateName = (rule, value, callback) => {\r\n            if (value === '') {\r\n                callback(new Error('The name cannot be empty'));\r\n            } else {\r\n                callback();\r\n            }\r\n        };\r\n        return {\r\n            // 是否有权限\r\n            haveRule: true,\r\n\r\n            // 是否是管理员\r\n            ISAdmin: false,\r\n\r\n            formCustom: [],\r\n            ruleCustom: {\r\n                name: [\r\n                    { validator: validateName, trigger: 'blur' }\r\n                ],\r\n            },\r\n\r\n            // 权限 是管理员 则显示未空  不是管理员 则获取权限数据\r\n            rules: ''\r\n        }\r\n    },\r\n    created() {\r\n\r\n        // 获取是否是管理员权限\r\n        let isAdmin = JSON.parse(sessionStorage.getItem('userinfo'))['isAdmin'];\r\n        this.ISAdmin = isAdmin;\r\n\r\n        if (isAdmin == true) {\r\n\r\n            let getData = sessionStorage.getItem('getData')\r\n\r\n            if (getData) {\r\n                let session_name = JSON.parse(getData).name;\r\n                if (session_name != 'admin') {\r\n                    this.getWebsite();\r\n                }\r\n            } else {\r\n                this.getWebsite();\r\n            }\r\n\r\n        } else {\r\n            // 获取当前路由的参数menu_id \r\n            let menu_id = this.$router.currentRoute._value.query.menu_id;\r\n            this.checkAuth(menu_id);\r\n\r\n            // 判断是否有当前用户的规则数据  rules\r\n            let rules = sessionStorage.getItem('rules');\r\n            if (rules) {\r\n                this.rules = rules;\r\n            } else {\r\n                // 获取用户的规则数据\r\n                this.getUserToRules();\r\n            }\r\n\r\n        }\r\n\r\n    },\r\n    methods: {\r\n        // 来判断一个当前点击的菜单按钮是否存在于当前用户的规则里\r\n        isSubstring(menu_id, rules) {\r\n            if (this.ISAdmin == true) {\r\n                return true;\r\n            } else {\r\n                // 将 rules 字符串按逗号分隔为数组\r\n                let rulesArray = rules.split(',').map(item => parseInt(item.trim()));\r\n\r\n                // 检查 menu_id 是否包含在 rulesArray 中\r\n                return rulesArray.includes(parseInt(menu_id));\r\n            }\r\n        },\r\n        // 获取用户的规则数据rules\r\n        async getUserToRules() {\r\n            let that = this;\r\n            let user_id = JSON.parse(sessionStorage.getItem('userinfo'))['user_id'];\r\n            await that.$api.Admin.getUserToRules({ user_id: user_id }).then(function (response) {\r\n                if (response.data.code == 200) {\r\n                    that.rules = response.data.data;\r\n                    sessionStorage.setItem('rules', response.data.data)\r\n                }\r\n            }).catch(function (error) {\r\n                console.log(error);\r\n            });\r\n        },\r\n\r\n        // 查询当前窗口是否有权限\r\n        async checkAuth(menu_id) {\r\n            let that = this;\r\n            let userId = JSON.parse(sessionStorage.getItem('userinfo'))['user_id']\r\n            await that.$api.Admin.checkAuth({ id: menu_id, user_id: userId }).then(function (response) {\r\n                if (response.data.code == 200) {\r\n                    that.haveRule = true;\r\n                    that.getWebsite();\r\n                } else {\r\n                    that.haveRule = false;\r\n                }\r\n            }).catch(function (error) {\r\n                console.log(error)\r\n            })\r\n        },\r\n\r\n        // 获取website 数据\r\n        async getWebsite() {\r\n\r\n            // 查询缓存中是否有website数据\r\n            let websiteData = JSON.parse(sessionStorage.getItem('website'));\r\n\r\n            if (websiteData) {\r\n\r\n                this.formCustom = websiteData;\r\n\r\n            } else {\r\n\r\n                sessionStorage.setItem('getData', JSON.stringify({ name: 'admin' }));\r\n\r\n                let that = this;\r\n\r\n                that.$api.Website.getWebsite().then(function (response) {\r\n\r\n                    if (response.data.code == 200) {\r\n\r\n                        sessionStorage.setItem('website', JSON.stringify(response.data.data));\r\n\r\n                        that.formCustom = JSON.parse(sessionStorage.getItem('website'));\r\n\r\n                    }\r\n\r\n                }).catch(function (error) {\r\n                    that.$Message.error('Network error, request failed');\r\n                    console.log(error)\r\n                });\r\n            }\r\n\r\n        },\r\n        // 提交验证\r\n        handleSubmit(name, menu_auth_id) {\r\n            let that = this;\r\n            that.$refs[name].validate((valid) => {\r\n                if (valid) {\r\n\r\n                    // 判断是否有按钮权限\r\n                    that.checkIsAuthToButton(menu_auth_id);\r\n\r\n                } else {\r\n                    that.$Message.error('Fail!');\r\n                }\r\n            })\r\n        },\r\n        // 保存数据\r\n        async saveData() {\r\n            let that = this;\r\n            // 提交数据\r\n            await that.$api.Website.saveWebsite(that.formCustom).then(function (response) {\r\n\r\n                if (response.data.code == 200) {\r\n\r\n                    sessionStorage.removeItem('website')\r\n                    that.$Message.success(response.data.msg);\r\n                    that.getWebsite();\r\n                }\r\n\r\n            }).catch(function (error) {\r\n                that.$Message.error('Network error, request failed');\r\n                console.log(error)\r\n            });\r\n        },\r\n        // 判断是否有按钮权限\r\n        async checkIsAuthToButton(menu_auth_id) {\r\n            let that = this;\r\n            let user_id = JSON.parse(sessionStorage.getItem('userinfo'))['user_id'];\r\n            if (that.ISAdmin == false) {\r\n                await that.$api.Admin.checkIsAuthToButton({ user_id: user_id, menu_auth_id: menu_auth_id }).then(function (response) {\r\n                    if (response.data.code == 0) {\r\n                        that.$Message.error(response.data.msg);\r\n                    } else {\r\n                        that.saveData()\r\n                    }\r\n                }).catch(function (error) {\r\n                    console.log(error);\r\n                });\r\n            }else{\r\n                that.saveData()\r\n            }\r\n        },\r\n        // 重置\r\n        handleReset(name) {\r\n            this.$refs[name].resetFields();\r\n        }\r\n    }\r\n}\r\n</script>"],"names":["_sfc_main","rule","value","callback","isAdmin","getData","menu_id","rules","item","that","user_id","response","error","userId","websiteData","name","menu_auth_id","valid","$data","_createElementBlock","_hoisted_1","_createVNode","_component_Form","_component_FormItem","_component_Input","_cache","$event","$options","_createBlock","_component_Button","_hoisted_2","_component_NoAuth"],"mappings":"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"}