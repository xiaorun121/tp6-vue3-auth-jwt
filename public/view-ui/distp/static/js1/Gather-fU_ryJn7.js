import{E as C,T}from"./__vendor-oHGn7YgQ.js";import{aM as s,az as c,q as _,z as n,bs as d,o as u,p as m,bu as A,bk as M,r as N}from"./_@vue-AcWbRQZ2.js";import{_ as O}from"../js2/index-A1W57FR6.js";const x={components:{Editor:C,Toolbar:T},data(){return{editor:null,toolbarConfig:{},editorConfig:{placeholder:"Enter something...",MENU_CONF:{uploadImage:{server:"http://www.tp6.com/api/v1/uploadEditorImage",fieldName:"file",maxFileSize:20*1024*1024,maxNumberOfFiles:10,allowedFileTypes:["image/*"],withCredentials:!1,timeout:10*1e3,onBeforeUpload(t){return console.log("onBeforeUpload:","图片正在上传中,请耐心等待"),t},customInsert(t,e){console.log("customInsert:",t,e),t.code===200&&e(t.data,t.msg,t.data)},onProgress(t){console.log("onProgress",t)},onSuccess(t,e){console.log(`${t.name} 上传成功`,e)},onFailed(t,e){console.log(`${t.name} 上传失败`,e)},onError(t,e,a){console.log(`${t.name} 上传出错`,e,a)}}}},mode:"default",haveRule:!0,ISAdmin:!1,rules:"",columns:[{title:"ID",key:"id",width:80,sortable:!0,align:"center"},{title:"标题",key:"title",width:600,align:"center"},{title:"图片",key:"image",slot:"image",align:"center"},{title:"创建时间",key:"create_time",align:"center"},{title:"更新时间",key:"update_time",align:"center"},{title:"Action",width:110,slot:"action",align:"center"}],data:[],total:0,pageSize:10,pageSizeOpts:10,page:1,loading:!0,formValidateID:0,formValidate:{},modalSaveGather:!1,modelType:"add",ruleValidate:{url:[{required:!0,message:"The url cannot be empty",trigger:"blur"}],keywords:[{required:!0,message:"The keywords cannot be empty",trigger:"blur"}]}}},created(){let t=JSON.parse(sessionStorage.getItem("userinfo")).isAdmin;if(this.ISAdmin=t,t==!0)this.getGather();else{let e=this.$router.currentRoute._value.query.menu_id;this.checkAuth(e);let a=sessionStorage.getItem("rules");a?this.rules=a:this.getUserToRules()}},methods:{onCreated(t){this.editor=Object.seal(t)},isSubstring(t,e){return this.ISAdmin==!0?!0:e.split(",").map(r=>parseInt(r.trim())).includes(parseInt(t))},async getUserToRules(){let t=this,e=JSON.parse(sessionStorage.getItem("userinfo")).user_id;await t.$api.Admin.getUserToRules({user_id:e}).then(function(a){a.data.code==200&&(t.rules=a.data.data,sessionStorage.setItem("rules",a.data.data))}).catch(function(a){console.log(a)})},async checkAuth(t){let e=this,a=JSON.parse(sessionStorage.getItem("userinfo")).user_id;await e.$api.Admin.checkAuth({id:t,user_id:a}).then(function(r){r.data.code==200?(console.log(r.data.msg),e.haveRule=!0,e.getGather()):(console.log(r.data.msg),e.haveRule=!1)}).catch(function(r){console.log(r)})},async getGather(){let t=this,e={page:t.page,pageSize:t.pageSize};await t.$api.Gather.index(e).then(function(a){console.log(a),a.data.code==200?(t.data=a.data.data.data,t.total=a.data.data.total,t.pageSize=a.data.data.per_page):console.log(a.data.msg)}).catch(function(a){t.$Message.error("Network error, request failed")})},async saveGather(t,e){let a=this,r=JSON.parse(sessionStorage.getItem("userinfo")).user_id;a.ISAdmin==!1?await a.$api.Admin.checkIsAuthToButton({user_id:r,menu_auth_id:e}).then(function(o){o.data.code==0?a.$Message.error(o.data.msg):(a.modalSaveGather=!0,t>0?(a.modelType="read",a.getGatherToId(t)):(a.formValidateID=0,a.modelType="add"))}).catch(function(o){a.$Message.error("Network error, request failed"),console.log(o)}):(a.modalSaveGather=!0,t>0?(a.modelType="read",a.getGatherToId(t)):(a.formValidateID=0,a.modelType="add"))},async getGatherToId(t){let e=this;await e.$api.Gather.read(t).then(function(a){a.data.code==200?(e.formValidate=a.data.data,e.formValidateID=t):e.$Message.error(a.data.msg)}).catch(function(a){e.$Message.error("Network error, request failed")})},async clickDelGather(t,e){let a=this,r=JSON.parse(sessionStorage.getItem("userinfo")).user_id;a.ISAdmin==!1?await a.$api.Admin.checkIsAuthToButton({user_id:r,menu_auth_id:e}).then(function(o){o.data.code==0?a.$Message.error(o.data.msg):a.delGather(t)}).catch(function(o){a.$Message.error("Network error, request failed"),console.log(o)}):a.delGather(t)},async delGather(t){let e=this;await e.$Modal.confirm({title:"Del",content:"Are you sure you want to delete it?",onOk:function(){e.$api.Gather.delete(t).then(function(a){a.data.code==200&&(e.$Message.success(a.data.msg),setTimeout(()=>{e.getGather()},1500))}).catch(function(a){e.$Message.error("Network error, request failed")})}})},async saveGatherData(t){let e=this,a=e.formValidateID;a>0?await e.$api.Gather.update(a,t).then(function(r){r.data.code==200?(e.$Message.success(r.data.msg),setTimeout(()=>{e.formValidateID=0,e.formValidate={},e.$refs.formValidate.resetFields(),e.getGather()},2e3)):(e.$Message.error(r.data.msg),e.$refs.formValidate.resetFields())}).catch(function(r){e.$Message.error("Network error, request failed")}):await e.$api.Gather.save(t).then(function(r){r.data.code==200?(e.$Message.success(r.data.msg),setTimeout(()=>{e.formValidate={},e.$refs.formValidate.resetFields(),e.getGather()},1e3)):(e.$Message.error(r.data.msg),e.$refs.formValidate.resetFields())}).catch(function(r){e.$Message.error("Network error, request failed")})},AsyncSaveGather(t){let e=this;e.$refs[t].validate(a=>{a?setTimeout(()=>{e.modalSaveGather=!1,e.saveGatherData(e.formValidate)},1e3):(e.loading=!1,setTimeout(()=>{e.loading=!0},10))})},cancelModel(t){this.formValidate={},this.$refs[t].resetFields()},changePage(t){var e=this;e.page=t,e.getGather()},nextPage(t){var e=this;e.page=t,e.getGather()},prevPage(t){var e=this;e.page=t,e.getGather()},pageSizeChange(t){var e=this;e.pageSize=t,e.page=1,e.getGather()}}},z={key:0},D={style:{border:"1px solid #ccc"}},F={key:1};function P(t,e,a,r,o,i){const g=s("Icon"),h=s("Space"),f=s("Input"),p=s("FormItem"),v=s("Toolbar"),y=s("Editor"),S=s("Form"),V=s("Modal"),I=s("Image"),k=s("Table"),w=s("Page"),G=s("NoAuth");return o.haveRule?(c(),_("div",z,[n(h,{direction:"vertical",class:"demo-split"},{default:d(()=>[n(h,{wrap:"",class:"demo-split-pane"},{default:d(()=>[i.isSubstring(184,o.rules)?(c(),u(g,{key:0,type:"md-add-circle",size:"24",color:"#2db7f5",title:"add",onClick:e[0]||(e[0]=l=>i.saveGather(0,184))})):m("",!0)]),_:1})]),_:1}),o.formValidate?(c(),u(V,{key:0,modelValue:o.modalSaveGather,"onUpdate:modelValue":e[4]||(e[4]=l=>o.modalSaveGather=l),ref:"refTaskFlowModal",title:"saveGather",loading:o.loading,onOnOk:e[5]||(e[5]=l=>i.AsyncSaveGather("formValidate")),onOnCancel:e[6]||(e[6]=l=>i.cancelModel("formValidate")),"lock-scroll":"true",closable:"false",scrollable:!1,width:"78%"},{default:d(()=>[n(S,{ref:"formValidate",model:o.formValidate,rules:o.ruleValidate,"label-position":"left","label-width":60},{default:d(()=>[n(p,{label:"title",prop:"title"},{default:d(()=>[n(f,{modelValue:o.formValidate.title,"onUpdate:modelValue":e[1]||(e[1]=l=>o.formValidate.title=l),placeholder:"Enter something...",type:"textarea"},null,8,["modelValue"])]),_:1}),n(p,{label:"content",prop:"content"},{default:d(()=>[N("div",D,[n(v,{style:{"border-bottom":"1px solid #ccc"},editor:o.editor,defaultConfig:o.toolbarConfig,mode:o.mode},null,8,["editor","defaultConfig","mode"]),n(y,{style:{height:"500px","overflow-y":"hidden"},modelValue:o.formValidate.content,"onUpdate:modelValue":e[2]||(e[2]=l=>o.formValidate.content=l),defaultConfig:o.editorConfig,mode:o.mode,onOnCreated:i.onCreated},null,8,["modelValue","defaultConfig","mode","onOnCreated"])])]),_:1}),n(f,{type:"hidden",modelValue:o.formValidateID,"onUpdate:modelValue":e[3]||(e[3]=l=>o.formValidateID=l)},null,8,["modelValue"])]),_:1},8,["model","rules"])]),_:1},8,["modelValue","loading"])):m("",!0),n(k,{border:"","max-height":"720",columns:o.columns,data:o.data,size:"small",style:{margin:"10px"}},{image:d(({row:l})=>[l.image?(c(),u(I,{key:0,src:[l.image],fit:"contain",width:"120px",height:"80px",preview:"","preview-list":[l.image]},null,8,["src","preview-list"])):m("",!0)]),action:d(({row:l,index:q})=>[i.isSubstring(182,o.rules)?(c(),u(g,{key:0,type:"ios-create",size:"24",color:"#47cb89",title:"edit",onClick:b=>i.saveGather(l.id,182)},null,8,["onClick"])):m("",!0),i.isSubstring(183,o.rules)?(c(),u(g,{key:1,type:"ios-trash",size:"24",color:"red",title:"del",onClick:b=>i.clickDelGather(l.id,183)},null,8,["onClick"])):m("",!0)]),_:1},8,["columns","data"]),A(n(w,{total:o.total,"page-size":o.pageSize,onOnNext:i.nextPage,onOnPrev:i.prevPage,onOnChange:i.changePage,onOnPageSizeChange:i.pageSizeChange,"show-sizer":"","show-total":"","show-elevator":"",style:{margin:"10px"}},null,8,["total","page-size","onOnNext","onOnPrev","onOnChange","onOnPageSizeChange"]),[[M,o.total>10]])])):(c(),_("div",F,[n(G)]))}const R=O(x,[["render",P]]);export{R as default};
//# sourceMappingURL=Gather-fU_ryJn7.js.map
